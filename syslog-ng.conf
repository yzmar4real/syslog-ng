@version: 4.0
@include "scl.conf"

# Sources: Define where logs come from
source s_network {
    udp(ip(0.0.0.0) port(514));
    tcp(ip(0.0.0.0) port(514));
    syslog(ip(0.0.0.0) port(601) transport("tcp"));
};

# Destination: Store logs locally and forward to Loki
destination d_logs {
    file("/var/log/$HOST/$YEAR-$MONTH-$DAY.log" create_dirs(yes));
};

destination d_loki {
    syslog("loki" port(514) transport("tcp"));  # Forward to Loki (assumes Loki syslog support)
    # Alternatively, use HTTP push if needed (requires additional setup)
};

# Log path: Connect source to destinations
log {
    source(s_network);
    destination(d_logs);  # Keep local copy
    destination(d_loki);  # Send to Loki
};
